# 《图解 http 》读书笔记

看书中记录是 2015.7.10 购买的，那会儿我还没来北京，那本书就是专门从济南带到北京来的，说明这本书比较重要。书的内容在当初买了就很详细的看过，那会儿我看书不像现在这么快，很仔细。近期准备写一个 nodejs 的系列博客，其中会涉及到很多 http 的知识，因此再翻看一遍，顺便记录读书笔记。

本书是一位日本人写的，我很喜欢这本书的表达方式 —— 突出重点、浅显易懂！很符合我经常说的 2/8 原则。如果感觉看着不过瘾，还可以去阅读更加高大上的《 HTTP 权威指南》，厚厚的枕头书。不过，我感觉作为一名前端程序猿，仔细看看这本书就够了。

----

## 什么是 http 协议

网络（包括互联网）都是建立在 **TCP/IP 协议族** 基础上的，其中常见的具体协议有 http ftp ssh dns TCP IP等，http 协议仅仅是其中的一个子集。先了解出处和来源。

### 三次握手

书中介绍了 **TCP 协议的“三次握手”**。详细内容可参见网络资料，用简单的话语总结就是：

- 第一次，客户端发送一些数据到 server 端，要求建立连接
- 第二次，server 端收到，然后发送一些数据回去，表明可以建立连接
- 第三次，客户端收到并检查返回的信息，若信息正确，再发送数据到 server 端，告知建立连接成功

PS：**http 1.1 版本开始支持持久连接`Connection: keep-alive`**，只要连接双方不明确终点连接，连接就会持续保持，即每次发送数据无需再进行“三次握手”

### 临时想到的

> 按照 TCP/IP 协议族的层次划分，TCP 位于传输层，提供可靠的字节流服务。所谓字**节流服务（Byte Stream Service）**是指，为了方便传输，将大块数据分割成以报文段（segment）为代为的数据包就行管理。

读到书中这段文字（12页），想到了一个关于数据**结构化和非结构化**的话题，需要分开来说：

- **存储 & 传输：非结构化数据**，例如上文提到的传输过程中的字节流服务（在 nodejs 中的 Stream 会有更贴切的体现），再如存储为文件的文本、图片、视频等。非结构化的数据无法用户复杂计算。
- **计算：结构化数据**，进行复杂的逻辑运算，前提是需要结构化的数据，因此学习算法之前要先学习数据结构。这样就涉及到非结构和结构化相互转换的一个问题，最简单的示例就是`JSON.parse`和`JSON.stringify`

----

## http 报文构成内容

<img src="https://images2017.cnblogs.com/blog/138012/201801/138012-20180124172039959-43595627.png" style="width:500px"/>

上图是 request 的报文图解，内容有：

- **Method**
- URI
- 协议版本
- **Head 头部字段**
- 内容实体

<img src="https://images2017.cnblogs.com/blog/138012/201801/138012-20180124172048490-1554822503.png" style="width:500px"/>

上图是 response 的报文图解，内容有：

- 协议版本
- **状态码**
- 状态码的原因短语
- **Head 头部字段**
- 主体内容

PS：报文内容中，头部内容和主体内容是通过 **空行（CR+LF）** 区分开来的。

----

## Method

> 和 Method 比较相关的新概念是 RESTful API ，可去查阅相关的资料，本文不展开。

常用的 Method 有两种：

- `GET` 获取信息
- `POST` 传输信息

其他 Method

- `PUT` 传输文件。自身不带验证机制，存在安全问题，一般的 web 网站不推荐使用
- `HEAD` 获取 Head 信息。不返回报文主体。用于确认 URI 有效性即资源更新的日期时间等
- `DELETE` 删除文件。跟`PUT`一样，不安全

还有 `OPTIONS` `TRACE` `CONNECT` 等，不常用。

----

## http 状态码

- `1xx` 请求正在处理
- `2xx` 成功
- `3xx` 重定向
- `4xx` 客户端错误
- `5xx` 服务端错误

以上是状态码的分类。书中提到，全部的状态码总共有 60 多种，但实际常用的就 14 种（其实常用的不到 14 种）。下面分类别简述：

### `1xx`

无

### `2xx`

- `200` 成功
- `204` 成功，但没有返回实体。一般用于只往客户端发送信息，而不需要客户端返回内容的情况（不常见）。
- `206` 范围请求，不是全部。用 Head 中的`Content-Range`来指定范围。

### `3xx`

- `301` 永久重定向。如`http://xxx.com`这个 Get 请求（最后没有`/`），就会被`301`到`http://xxx.com/`（最后是`/`）
- `302` 临时从定向。临时的，不是永久的。
- `304` 资源找到但是不符合请求条件，不会返回任何主体。如发送 GET 请求时，head 中有`If-Modified-Since: xxx`（要求返回更新时间是`xxx`时间之后的资源），如果此时 server 端资源未更新，则会返回`304`，即不符合要求。

### `4xx`

- `401` 请求需认证，登录
- `403` 被拒绝，例如外域图片盗链
- `404` 请求资源未找到

### `5xx`

- `500` 服务器执行请求期间发生错误，如程序出现 bug
- `503` 超负载或者维护停机

----

## http head

分类：

- 通用首部字段
- 请求首部字段
- 响应首部字段
- 实体首部字段





**重点：cookie UA **


----

## https


----

## 扩展 & 遗留问题





